var J=Object.defineProperty;var z=(m,v,g)=>v in m?J(m,v,{enumerable:!0,configurable:!0,writable:!0,value:g}):m[v]=g;var x=(m,v,g)=>z(m,typeof v!="symbol"?v+"":v,g);(function(m){typeof define=="function"&&define.amd?define(m):m()})(function(){"use strict";const m=".ideabosque-ai-iframe{border-radius:20px;background:#fff;overflow:hidden;border:none;box-shadow:0 -4px 16px 0 rgba(0,0,0,.25);}@media (max-width:640px){.ideabosque-ai-iframe{margin-bottom:24px;width:100% !important;height:580px !important;}}";function v(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var g={exports:{}},E;function A(){return E||(E=1,function(o){var c=Object.prototype.hasOwnProperty,r="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(r=!1));function d(a,t,n){this.fn=a,this.context=t,this.once=n||!1}function w(a,t,n,s,h){if(typeof n!="function")throw new TypeError("The listener must be a function");var p=new d(n,s||a,h),l=r?r+t:t;return a._events[l]?a._events[l].fn?a._events[l]=[a._events[l],p]:a._events[l].push(p):(a._events[l]=p,a._eventsCount++),a}function b(a,t){--a._eventsCount===0?a._events=new i:delete a._events[t]}function f(){this._events=new i,this._eventsCount=0}f.prototype.eventNames=function(){var t=[],n,s;if(this._eventsCount===0)return t;for(s in n=this._events)c.call(n,s)&&t.push(r?s.slice(1):s);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(n)):t},f.prototype.listeners=function(t){var n=r?r+t:t,s=this._events[n];if(!s)return[];if(s.fn)return[s.fn];for(var h=0,p=s.length,l=new Array(p);h<p;h++)l[h]=s[h].fn;return l},f.prototype.listenerCount=function(t){var n=r?r+t:t,s=this._events[n];return s?s.fn?1:s.length:0},f.prototype.emit=function(t,n,s,h,p,l){var y=r?r+t:t;if(!this._events[y])return!1;var e=this._events[y],_=arguments.length,O,u;if(e.fn){switch(e.once&&this.removeListener(t,e.fn,void 0,!0),_){case 1:return e.fn.call(e.context),!0;case 2:return e.fn.call(e.context,n),!0;case 3:return e.fn.call(e.context,n,s),!0;case 4:return e.fn.call(e.context,n,s,h),!0;case 5:return e.fn.call(e.context,n,s,h,p),!0;case 6:return e.fn.call(e.context,n,s,h,p,l),!0}for(u=1,O=new Array(_-1);u<_;u++)O[u-1]=arguments[u];e.fn.apply(e.context,O)}else{var I=e.length,k;for(u=0;u<I;u++)switch(e[u].once&&this.removeListener(t,e[u].fn,void 0,!0),_){case 1:e[u].fn.call(e[u].context);break;case 2:e[u].fn.call(e[u].context,n);break;case 3:e[u].fn.call(e[u].context,n,s);break;case 4:e[u].fn.call(e[u].context,n,s,h);break;default:if(!O)for(k=1,O=new Array(_-1);k<_;k++)O[k-1]=arguments[k];e[u].fn.apply(e[u].context,O)}}return!0},f.prototype.on=function(t,n,s){return w(this,t,n,s,!1)},f.prototype.once=function(t,n,s){return w(this,t,n,s,!0)},f.prototype.removeListener=function(t,n,s,h){var p=r?r+t:t;if(!this._events[p])return this;if(!n)return b(this,p),this;var l=this._events[p];if(l.fn)l.fn===n&&(!h||l.once)&&(!s||l.context===s)&&b(this,p);else{for(var y=0,e=[],_=l.length;y<_;y++)(l[y].fn!==n||h&&!l[y].once||s&&l[y].context!==s)&&e.push(l[y]);e.length?this._events[p]=e.length===1?e[0]:e:b(this,p)}return this},f.prototype.removeAllListeners=function(t){var n;return t?(n=r?r+t:t,this._events[n]&&b(this,n)):(this._events=new i,this._eventsCount=0),this},f.prototype.off=f.prototype.removeListener,f.prototype.addListener=f.prototype.on,f.prefixed=r,f.EventEmitter=f,o.exports=f}(g)),g.exports}var P=A();const S=v(P),L="ideabosque";class q{constructor(c){x(this,"iframe");x(this,"event",new S);x(this,"init",()=>{window.addEventListener("message",this.onMessage)});x(this,"sendMessage",(c,r)=>{const i=JSON.stringify(r),d=`${L}-${c}`;this.win.postMessage({type:d,data:i},"*")});x(this,"on",(c,r)=>(this.event.on(c,r),this.event));x(this,"onMessage",c=>{const r=c.data.type;let i=c.data.data;if(r.includes(L)){const d=r.replace(`${L}-`,"");i&&(i=JSON.parse(i)),this.event.emit(d,i)}});this.iframe=c,this.init()}get win(){return this.iframe.contentWindow}}const N=o=>{document.addEventListener("DOMContentLoaded",o)},M=o=>{const c=o.getAttribute("width")||640,r=o.getAttribute("height")||600;return{width:c,height:r}},$=()=>new Promise((o,c)=>{window.navigator.geolocation.getCurrentPosition(i=>{o(i.coords.toJSON())},async i=>{c(i)})});let C="https://ideabosque-ai-chat.pages.dev";const j=()=>{const o=document.querySelector("head"),c=document.createElement("style");c.setAttribute("data-role",`${L}-style`),c.innerHTML=m,o==null||o.appendChild(c)},T=()=>{const o=`script[data-role='${L}-ai']`;return document.querySelector(o)},F=(o,c)=>{j();const r=M(c),i=document.createElement("iframe"),d=c.getAttribute("iframe-url");return o.appendChild(i),d&&(C=d),i.src=`${C}?mode=iframe`,i.className=`${L}-ai-iframe`,i.style.width=r.width+"px",i.style.height=r.height+"px",i.setAttribute("frameborder","0"),i};N(()=>{const o=T(),c=o==null?void 0:o.getAttribute("selector"),r=document.querySelector(c);if(!r)return;const i=F(r,o),d=new q(i);d.on("get-position",async()=>{let w=!0,b={};try{b=await $()}catch{w=!1}d.sendMessage("get-position",{...b,success:w})})})});
