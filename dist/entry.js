var J=Object.defineProperty;var z=(m,g,w)=>g in m?J(m,g,{enumerable:!0,configurable:!0,writable:!0,value:w}):m[g]=w;var x=(m,g,w)=>z(m,typeof g!="symbol"?g+"":g,w);(function(m){typeof define=="function"&&define.amd?define(m):m()})(function(){"use strict";const m=".ideabosque-ai-iframe{border-radius:20px;background:#fff;overflow:hidden;border:none;box-shadow:0 -4px 16px 0 rgba(0,0,0,.25);}@media (max-width:640px){.ideabosque-ai-iframe{margin-bottom:24px;width:100% !important;height:580px !important;}}";function g(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var w={exports:{}},E;function A(){return E||(E=1,function(o){var c=Object.prototype.hasOwnProperty,e="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(e=!1));function d(a,n,r){this.fn=a,this.context=n,this.once=r||!1}function v(a,n,r,s,h){if(typeof r!="function")throw new TypeError("The listener must be a function");var p=new d(r,s||a,h),l=e?e+n:n;return a._events[l]?a._events[l].fn?a._events[l]=[a._events[l],p]:a._events[l].push(p):(a._events[l]=p,a._eventsCount++),a}function b(a,n){--a._eventsCount===0?a._events=new i:delete a._events[n]}function f(){this._events=new i,this._eventsCount=0}f.prototype.eventNames=function(){var n=[],r,s;if(this._eventsCount===0)return n;for(s in r=this._events)c.call(r,s)&&n.push(e?s.slice(1):s);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(r)):n},f.prototype.listeners=function(n){var r=e?e+n:n,s=this._events[r];if(!s)return[];if(s.fn)return[s.fn];for(var h=0,p=s.length,l=new Array(p);h<p;h++)l[h]=s[h].fn;return l},f.prototype.listenerCount=function(n){var r=e?e+n:n,s=this._events[r];return s?s.fn?1:s.length:0},f.prototype.emit=function(n,r,s,h,p,l){var y=e?e+n:n;if(!this._events[y])return!1;var t=this._events[y],_=arguments.length,O,u;if(t.fn){switch(t.once&&this.removeListener(n,t.fn,void 0,!0),_){case 1:return t.fn.call(t.context),!0;case 2:return t.fn.call(t.context,r),!0;case 3:return t.fn.call(t.context,r,s),!0;case 4:return t.fn.call(t.context,r,s,h),!0;case 5:return t.fn.call(t.context,r,s,h,p),!0;case 6:return t.fn.call(t.context,r,s,h,p,l),!0}for(u=1,O=new Array(_-1);u<_;u++)O[u-1]=arguments[u];t.fn.apply(t.context,O)}else{var I=t.length,k;for(u=0;u<I;u++)switch(t[u].once&&this.removeListener(n,t[u].fn,void 0,!0),_){case 1:t[u].fn.call(t[u].context);break;case 2:t[u].fn.call(t[u].context,r);break;case 3:t[u].fn.call(t[u].context,r,s);break;case 4:t[u].fn.call(t[u].context,r,s,h);break;default:if(!O)for(k=1,O=new Array(_-1);k<_;k++)O[k-1]=arguments[k];t[u].fn.apply(t[u].context,O)}}return!0},f.prototype.on=function(n,r,s){return v(this,n,r,s,!1)},f.prototype.once=function(n,r,s){return v(this,n,r,s,!0)},f.prototype.removeListener=function(n,r,s,h){var p=e?e+n:n;if(!this._events[p])return this;if(!r)return b(this,p),this;var l=this._events[p];if(l.fn)l.fn===r&&(!h||l.once)&&(!s||l.context===s)&&b(this,p);else{for(var y=0,t=[],_=l.length;y<_;y++)(l[y].fn!==r||h&&!l[y].once||s&&l[y].context!==s)&&t.push(l[y]);t.length?this._events[p]=t.length===1?t[0]:t:b(this,p)}return this},f.prototype.removeAllListeners=function(n){var r;return n?(r=e?e+n:n,this._events[r]&&b(this,r)):(this._events=new i,this._eventsCount=0),this},f.prototype.off=f.prototype.removeListener,f.prototype.addListener=f.prototype.on,f.prefixed=e,f.EventEmitter=f,o.exports=f}(w)),w.exports}var P=A();const S=g(P),L="ideabosque";class q{constructor(c){x(this,"iframe");x(this,"event",new S);x(this,"init",()=>{window.addEventListener("message",this.onMessage)});x(this,"sendMessage",(c,e)=>{const i=JSON.stringify(e),d=`${L}-${c}`;this.win.postMessage({type:d,data:i},"*")});x(this,"on",(c,e)=>(this.event.on(c,e),this.event));x(this,"onMessage",c=>{var d;const e=c.data.type;let i=c.data.data;if((d=e==null?void 0:e.includes)!=null&&d.call(e,L)){const v=e.replace(`${L}-`,"");i&&(i=JSON.parse(i)),this.event.emit(v,i)}});this.iframe=c,this.init()}get win(){return this.iframe.contentWindow}}const N=o=>{document.addEventListener("DOMContentLoaded",o)},M=o=>{const c=o.getAttribute("width")||640,e=o.getAttribute("height")||600;return{width:c,height:e}},$=()=>new Promise((o,c)=>{window.navigator.geolocation.getCurrentPosition(i=>{o(i.coords.toJSON())},async i=>{c(i)})});let C="https://ideabosque-ai-chat.pages.dev";const j=()=>{const o=document.querySelector("head"),c=document.createElement("style");c.setAttribute("data-role",`${L}-style`),c.innerHTML=m,o==null||o.appendChild(c)},T=()=>{const o=`script[data-role='${L}-ai']`;return document.querySelector(o)},F=(o,c)=>{j();const e=M(c),i=document.createElement("iframe"),d=c.getAttribute("iframe-url");return o.appendChild(i),d&&(C=d),i.src=`${C}?mode=iframe`,i.className=`${L}-ai-iframe`,i.style.width=e.width+"px",i.style.height=e.height+"px",i.setAttribute("frameborder","0"),i};N(()=>{const o=T(),c=o==null?void 0:o.getAttribute("selector"),e=document.querySelector(c);if(!e)return;const i=F(e,o),d=new q(i);d.on("get-position",async()=>{let v=!0,b={};try{b=await $()}catch{v=!1}d.sendMessage("get-position",{...b,success:v})})})});
